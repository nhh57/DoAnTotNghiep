<!DOCTYPE html>
<html xmlns="http://www.thymeleaf.org">
<head>
    <meta charset="utf-8"/>
    <meta name="viewport"
          content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <link rel="apple-touch-icon" sizes="76x76"
          th:href="@{/admin/assets/img/apple-icon.png}">
    <link rel="icon" type="image/png"
          th:href="@{/admin/assets/img/favicon.png}">
    <title>ADMIN</title>
    <!--     Fonts and icons     -->
    <link rel="stylesheet" type="text/css"
          href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700,900|Roboto+Slab:400,700"/>
    <!-- Nucleo Icons -->
    <link
            th:href="@{/admin/assets/css/nucleo-icons.css}"
            rel="stylesheet"/>
    <link
            th:href="@{/admin/assets/css/nucleo-svg.css}"
            rel="stylesheet"/>
    <!-- Font Awesome Icons -->
    <script src="https://kit.fontawesome.com/42d5adcbca.js"
            crossorigin="anonymous"></script>
    <!-- Material Icons -->
    <link
            href="https://fonts.googleapis.com/icon?family=Material+Icons+Round"
            rel="stylesheet">
    <!-- CSS Files -->
    <link id="pagestyle"
          th:href="@{/admin/assets/css/material-dashboard.css?v=3.0.0}"
          rel="stylesheet"/>
    <link
            th:href="@{/admin/custom/css/index.css}"
            rel="stylesheet"/>

</head>

<body class="g-sidenav-show  bg-gray-200">
<aside
        class="sidenav navbar navbar-vertical navbar-expand-xs border-0 border-radius-xl my-3 fixed-start ms-3   bg-gradient-dark"
        id="sidenav-main">
    <div class="sidenav-header">
        <i
                class="fas fa-times p-3 cursor-pointer text-white opacity-5 position-absolute end-0 top-0 d-none d-xl-none"
                aria-hidden="true" id="iconSidenav"></i> <a class="navbar-brand m-0"
                                                            th:href="@{/mvc/admin/category}"
                                                            target="_blank"> <img
            th:src="@{/admin/assets/img/logo-ct.png}"
            class="navbar-brand-img h-100" alt="main_logo"> <span
            class="ms-1 font-weight-bold text-white">ADMIN</span>
    </a>
    </div>
    <hr class="horizontal light mt-0 mb-2">
    <div class="collapse navbar-collapse  w-auto  max-height-vh-100"
         id="sidenav-collapse-main">
        <ul class="navbar-nav">
            <li class="nav-item"><a
                    class="nav-link text-white"
                    th:href="@{/mvc/admin/category}">
                <div
                        class="text-white text-center me-2 d-flex align-items-center justify-content-center">
                    <i class="material-icons opacity-10">dashboard</i>
                </div>
                <span class="nav-link-text ms-1">Quản lý loại sản phẩm</span>
            </a></li>
            <li class="nav-item"><a
                    class="nav-link text-white"
                    th:href="@{/mvc/admin/brand}">
                <div
                        class="text-white text-center me-2 d-flex align-items-center justify-content-center">
                    <i class="material-icons opacity-10">table_view</i>
                </div>
                <span class="nav-link-text ms-1">Quản lý hãng</span>
            </a></li>
            <li class="nav-item"><a
                    class="nav-link text-white"
                    th:href="@{/mvc/admin/product}">
                <div
                        class="text-white text-center me-2 d-flex align-items-center justify-content-center">
                    <i class="material-icons opacity-10">assignment</i>
                </div>
                <span class="nav-link-text ms-1">Quản lý sản phẩm</span>
            </a></li>
            <li class="nav-item"><a class="nav-link text-white " th:href="@{/mvc/admin/account}">
                <div
                        class="text-white text-center me-2 d-flex align-items-center justify-content-center">
                    <i class="material-icons opacity-10">person</i>
                </div>
                <span class="nav-link-text ms-1">Quản lý khách hàng</span>
            </a></li>
            <li class="nav-item"><a
                    class="nav-link text-white"
                    th:href="@{/mvc/admin/order}">
                <div
                        class="text-white text-center me-2 d-flex align-items-center justify-content-center">
                    <i class="material-icons opacity-10">receipt_long</i>
                </div>
                <span class="nav-link-text ms-1">Quản lý hóa đơn</span>
            </a></li>
            <li class="nav-item"><a
                    class="nav-link text-white"
                    th:href="@{/mvc/admin/sale}">
                <div
                        class="text-white text-center me-2 d-flex align-items-center justify-content-center">
                    <i class="material-icons opacity-10">view_in_ar</i>
                </div>
                <span class="nav-link-text ms-1">Quản lý khuyến mãi</span>
            </a></li>
            <li class="nav-item"><a
                    class="nav-link text-white active bg-gradient-primary"
                    th:href="@{/mvc/admin/report}">
                <div
                        class="text-white text-center me-2 d-flex align-items-center justify-content-center">
                    <i class="material-icons opacity-10">format_textdirection_r_to_l</i>
                </div>
                <span class="nav-link-text ms-1">Thống kê</span>
            </a></li>
            <li class="nav-item"><a class="nav-link text-white "
                                    href="/mvc/admin/logout?urlReturn=report">
                <div class="text-white text-center me-2 d-flex align-items-center justify-content-center">
                    <i class="material-icons opacity-10">logout</i>
                </div>
                <span class="nav-link-text ms-1">Đăng xuất</span>
            </a></li>
        </ul>
    </div>
</aside>
<main
        class="main-content position-relative max-height-vh-100 h-100 border-radius-lg ">
    <!-- Navbar -->
    <nav
            class="navbar navbar-main navbar-expand-lg px-0 mx-4 shadow-none border-radius-xl"
            id="navbarBlur" navbar-scroll="true">
        <div class="container-fluid py-1 px-3">
            <nav aria-label="breadcrumb">
                <ol
                        class="breadcrumb bg-transparent mb-0 pb-0 pt-1 px-0 me-sm-6 me-5">
                    <li class="breadcrumb-item text-sm"><a
                            class="opacity-5 text-dark" href="javascript:;">Admin</a></li>
                    <li class="breadcrumb-item text-sm text-dark active"
                        aria-current="page">Report
                    </li>
                </ol>
                <h6 class="font-weight-bolder mb-0">Thống kê doanh thu theo năm</h6>
            </nav>
            <div class="collapse navbar-collapse mt-sm-0 mt-2 me-md-0 me-sm-4"
                 id="navbar">
                <form action="/mvc/admin/brand" method="get" class="ms-md-auto pe-md-3 d-flex align-items-center">
                    <div class="input-group input-group-outline">
                    </div>
                </form>
                <ul class="navbar-nav  justify-content-end">
                    <div style="margin-top: 20px; float:right" class="dropdown nav-item d-flex align-items-center">
                        <i class="fa fa-user dropbtn btn btn-success dropdown-toggle"
                           aria-hidden="true" id="dropdownMenuButton"
                           data-toggle="dropdown" aria-haspopup="true"
                           aria-expanded="false"> Hi, [[${admin.username}]]</i>
                        <div class="dropdown-menu" aria-labelledby="dropdownMenuButton">
                            <a class="dropdown-item" href="/mvc/admin/logout?urlReturn=report">Đăng
                                xuất</a>

                        </div>
                    </div>
                    <li class="nav-item d-xl-none ps-3 d-flex align-items-center">
                        <a href="javascript:;" class="nav-link text-body p-0"
                           id="iconNavbarSidenav">
                            <div class="sidenav-toggler-inner">
                                <i class="sidenav-toggler-line"></i> <i
                                    class="sidenav-toggler-line"></i> <i
                                    class="sidenav-toggler-line"></i>
                            </div>
                        </a>
                </ul>
            </div>
        </div>
    </nav>
    <!-- End Navbar -->
    <div style="margin:0 20px;">
        <ul class="nav nav-pills">
            <li class="nav-item">
                <a class="nav-link nav-custom" href="/mvc/admin/report?tag=1">Sản phẩm</a>
            </li>
            <li class="nav-item">
                <a class="nav-link nav-custom activeTabCustom" href="/mvc/admin/report?tag=2">Khách hàng</a>
            </li>
            <li class="nav-item">
                <a class="nav-link nav-custom" href="/mvc/admin/report?tag=3">Thời gian</a>
            </li>
        </ul>
    </div>
    <form style="margin:0 20px;">
        <label for="startDate">
            Từ:
        </label>
        <input th:if="${startDate} != null" th:value="${startDate}" name="startDate" id="startDate" class="dateForm"
               type="date">
        <input th:unless="${startDate} != null" name="startDate" id="startDate" class="dateForm" type="date">
        <label for="endDate">
            Đến:
        </label>
        <input th:if="${endDate} != null" th:value="${endDate}" name="endDate" id="endDate" class="dateForm"
               type="date">
        <input th:unless="${endDate} != null" th:value="${endDate}" name="endDate" id="endDate" class="dateForm"
               type="date">
        <input type="hidden" name="tag" value="2">
        <input type="hidden" name="tabPanelIndex" id="idTab" th:value="${tabPanelIndex}">
        <button style="margin-top: 14px;" formaction="/mvc/admin/report" formmethod="get" class="btn btn-success">
            Lọc
        </button>
        <a style="margin-top: 14px;" href="/mvc/admin/report?tag=2" class="btn btn-danger tab-panel-custom">Xóa lọc</a>
        <a style="margin-top: 14px;" href="/mvc/admin/report/user/export-excel" class="btn btn-info">Xuất file Excel</a>
    </form>
    <div class="container-fluid py-4" style="background-color:#fff">
        <ul class="nav nav-tabs" id="myTab" role="tablist">
            <li class="nav-item">
                <a class="nav-link" href="#tongQuan" role="tab" data-toggle="tab">Tổng quan</a>
            </li>
            <li class="nav-item">
                <a class="nav-link" href="#chiTiet" role="tab" data-toggle="tab">Chi tiết</a>
            </li>
        </ul>

        <!-- Tab panes -->
        <div class="tab-content">
            <div role="tabpanel" class="tab-pane fade" id="tongQuan">
                <div id="myChart" class="card my-4" style="with:1200px !important; height:600px; "></div>
            </div>
            <div role="tabpanel" class="tab-pane fade" id="chiTiet">
                <div class="card my-4" style="margin-top:50px !important;">
                    <div class="card-header p-0 position-relative mt-n4 mx-3 z-index-2">
                        <div
                                class="bg-gradient-primary shadow-primary border-radius-lg pt-4 pb-3">
                            <h6 class="text-white text-capitalize ps-3">Danh sách khách hàng</h6>
                        </div>
                    </div>
                    <div class="card-body px-0 pb-2">
                        <div class="table-responsive p-0">
                            <table class="table align-items-center mb-0">
                                <thead>
                                <tr>
                                    <th
                                            class="text-center text-uppercase text-secondary text-xxs font-weight-bolder opacity-7">
                                        Id
                                    </th>
                                    <th
                                            class="text-center text-uppercase text-secondary text-xxs font-weight-bolder opacity-7">
                                        Tài khoản
                                    </th>
                                    <th
                                            class="text-center text-uppercase text-secondary text-xxs font-weight-bolder opacity-7">
                                        Họ và tên
                                    </th>
                                    <th
                                            class="text-center text-uppercase text-secondary text-xxs font-weight-bolder opacity-7">
                                        Tổng đơn mua
                                    </th>
                                    <th
                                            class="text-center text-uppercase text-secondary text-xxs font-weight-bolder opacity-7">
                                        Tổng tiền đã mua
                                    </th>

                                </tr>
                                </thead>
                                <tbody id="tableFilter">
                                <th:block th:each="item : ${listAccount}">
                                    <tr>
                                        <td class="align-middle text-center text-sm">
                                            <p class="text-xs font-weight-bold mb-0">[[${item.id}]]</p>
                                        </td>
                                        <td class="align-middle text-center text-sm">
                                            <p class="text-xs font-weight-bold mb-0">[[${item.username}]]</p>
                                        </td>
                                        <td class="align-middle text-center text-sm">
                                            <p class="text-xs font-weight-bold mb-0">[[${item.fullName}]]</p>
                                        </td>
                                        <td class="align-middle text-center text-sm">
                                            <p class="text-xs font-weight-bold mb-0">[[${item.countOrder}]]</p>
                                        </td>
                                        <td class="align-middle text-center"><span
                                                class="text-secondary text-xs font-weight-bold">[[${#numbers.formatDecimal(item.totalMoney, 0, 'COMMA', 0, 'POINT')}]] đ</span>
                                        </td>
                                        <td class="align-middle text-center">
                                            <a style="cursor: pointer;"
                                               class="text-secondary font-weight-bold text-xs tab-panel-custom"
                                               th:href="@{'/mvc/admin/report?tag=2&startDate='+${startDate}+'&endDate='+${endDate}+'&accountId='+${item.id}}"
                                            > Chi tiết
                                            </a>
                                        </td>
                                    </tr>
                                </th:block>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
                <div th:if="${listOrderResult} != null" class="row">
                    <div class="col-12">
                        <div class="card my-4">
                            <div
                                    class="card-header p-0 position-relative mt-n4 mx-3 z-index-2">
                                <div
                                        class="bg-gradient-primary shadow-primary border-radius-lg pt-4 pb-3">
                                    <h6 class="text-white text-capitalize ps-3">Danh sách hóa đơn</h6>
                                </div>
                            </div>
                            <div class="card-body px-0 pb-2">
                                <div class="table-responsive p-0">
                                    <table class="table align-items-center mb-0 tableProductCustom">
                                        <thead>
                                        <tr>
                                            <th class="text-center text-uppercase text-secondary text-xxs font-weight-bolder opacity-7">
                                                Mã hóa đơn
                                            </th>
                                            <th class="text-center text-uppercase text-secondary text-xxs font-weight-bolder opacity-7">
                                                Ngày xuất
                                            </th>
                                            <th class="text-center text-uppercase text-secondary text-xxs font-weight-bolder opacity-7">
                                                Phương thức thanh toán
                                            </th>
                                            <th class="text-center text-uppercase text-secondary text-xxs font-weight-bolder opacity-7">
                                                Phương thức vận chuyển
                                            </th>
                                            <th class="text-center text-uppercase text-secondary text-xxs font-weight-bolder opacity-7">
                                                Tổng tiền
                                            </th>
                                            <th class="text-center text-uppercase text-secondary text-xxs font-weight-bolder opacity-7">

                                            </th>
                                        </tr>
                                        </thead>
                                        <tbody>
                                        <th:block th:each="item : ${listOrderResult}">
                                            <tr>
                                                <td class="align-middle text-center text-sm">
                                                    <p class="text-xs font-weight-bold mb-0">[[${item.orders.id}]]</p>
                                                </td>
                                                <td class="align-middle text-center text-sm">
                                                    <p class="text-xs font-weight-bold mb-0">[[${#dates.format(item.orders.orderDate, 'dd-MM-yyyy')}]]</p>
                                                </td>
                                                <td class="align-middle text-center text-sm">
                                                    <p class="text-xs font-weight-bold mb-0">[[${item.orders.paymentMethod}]]</p>
                                                </td>
                                                <td class="align-middle text-center text-sm">
                                                    <p class="text-xs font-weight-bold mb-0">[[${item.orders.shipMethod}]]</p>
                                                </td>
                                                <td class="align-middle text-center text-sm">
                                                    <p class="text-xs font-weight-bold mb-0">[[${#numbers.formatDecimal(item.orders.totalMoney, 0, 'COMMA', 0, 'POINT')}]] đ</p>
                                                </td>
                                                <td class="align-middle text-center text-sm">
                                                    <a style="cursor: pointer;"
                                                       class="text-secondary font-weight-bold text-xs"
                                                       data-toggle="modal"
                                                       th:attr="data-target='#modalChiTiet'+${item.orders.id}"
                                                    > Chi tiết
                                                    </a>
                                                    <!-- The Modal -->
                                                    <div class="modal" th:id="'modalChiTiet'+${item.orders.id}">
                                                        <div class="modal-dialog modal-dialog-custom" >
                                                            <div class="modal-content">
                                                                <!-- Modal Header -->
                                                                <div class="modal-header">
                                                                    <h4 class="modal-title">Chi tiết hóa đơn #[[${item.orders.id}]]</h4>
                                                                    <button type="button" class="close" data-dismiss="modal">&times;</button>
                                                                </div>

                                                                <!-- Modal body -->
                                                                <div class="modal-body">
                                                                    <table class="table table-striped table-bordered">
                                                                        <thead>
                                                                        <tr>
                                                                            <th class="center">#</th>
                                                                            <th>Sản phẩm</th>
                                                                            <th class="hidden-480">Đơn giá</th>
                                                                            <th class="hidden-480">Số lượng</th>
                                                                            <th>Thành tiền</th>
                                                                        </tr>
                                                                        </thead>

                                                                        <tbody>
                                                                        <tr th:each="orderDetail : ${item.listOrderDetail}">
                                                                            <td class="center">1</td>
                                                                            <td>
                                                                                [[${orderDetail.productByProductId.productName}]]
                                                                            </td>
                                                                            <th class="hidden-480">
                                                                                [[${#numbers.formatDecimal(orderDetail.price,
                                                                                0, 'COMMA', 0, 'POINT')}]] đ
                                                                            </th>
                                                                            <td class="hidden-480">
                                                                                [[${orderDetail.amount}]]
                                                                            </td>
                                                                            <td>
                                                                                [[${#numbers.formatDecimal(orderDetail.price*orderDetail.amount,
                                                                                0, 'COMMA', 0, 'POINT')}]] đ
                                                                            </td>
                                                                        </tr>
                                                                        </tbody>
                                                                    </table>
                                                                </div>

                                                                <!-- Modal footer -->
                                                                <div class="modal-footer">
                                                                    <button type="button" class="btn btn-danger" data-dismiss="modal">Close</button>
                                                                </div>

                                                            </div>
                                                        </div>
                                                    </div>
                                                </td>
                                            </tr>
                                        </th:block>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</main>
<script
        th:src="@{/admin/assets/js/core/popper.min.js}"></script>
<script
        th:src="@{/admin/assets/js/core/bootstrap.min.js}"></script>
<script
        th:src="@{/admin/assets/js/plugins/perfect-scrollbar.min.js}"></script>
<script
        th:src="@{/admin/assets/js/plugins/smooth-scrollbar.min.js}"></script>
<script
        th:src="@{/admin/assets/js/plugins/chartjs.min.js}"></script>
<!-- Github buttons -->
<script async defer src="https://buttons.github.io/buttons.js"></script>
<!-- Control Center for Material Dashboard: parallax effects, scripts for the example pages etc -->
<script
        th:src="@{/admin/assets/js/material-dashboard.min.js?v=3.0.0}"></script>
<script
        th:src="@{/admin/assets/js/customAdmin.js}"></script>
<script src="https://code.jquery.com/jquery-3.2.1.slim.min.js"
        integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN"
        crossorigin="anonymous"></script>
<script
        src="https://cdn.jsdelivr.net/npm/popper.js@1.12.9/dist/umd/popper.min.js"
        integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q"
        crossorigin="anonymous"></script>
<script
        src="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/js/bootstrap.min.js"
        integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl"
        crossorigin="anonymous"></script>
<script th:src="@{/admin/custom/js/report.js}"></script>
<script src="https://www.gstatic.com/charts/loader.js"></script>
<script th:inline="javascript">
    /*<![CDATA[*/
    google.charts.load('current', {'packages':['corechart']});
    google.charts.setOnLoadCallback(drawChart);

    var listReport = /*[[${listAccountChart}]]*/;
    var result=[];
    var title=["Khách hàng","Doanh thu"];
    result.push(title);
    listReport.forEach(function(item){
        var arrayTemp=[];
        arrayTemp.push(item.fullName);
        arrayTemp.push(item.totalMoney);
        result.push(arrayTemp);
    });

    function drawChart() {
    var data = google.visualization.arrayToDataTable(result);

    var options = {
      title:'Thống kê doanh thu theo top 10 khách hàng',
      width: 1200,
      height: 600
    };

    var chart = new google.visualization.BarChart(document.getElementById('myChart'));
      chart.draw(data, options);
    }
    /*]]>*/
</script>
</body>

</html>